<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Wanderlust • Flight Results</title>
    <style>
        :root {
            --bg: #ffffff;
            /* Main background white */
            --surface: #f9fafb;
            /* Light gray surface (cards etc.) */
            --card: #ffffff;
            /* White cards */
            --muted: #5b6476;
            /* Muted gray text */
            --text: #000000;
            /* Main dark text */
            --accent: #2563eb;
            /* Blue accent */
            --accent-2: #1d4ed8;
            /* Darker blue hover state */
            --brand: #2563eb;
            /* Brand color */
            --stroke: #3b8df3;
            /* Border gray */
            --radius: 14px;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }

        * {
            box-sizing: border-box
        }

        html,
        body {
            height: 100%
        }

        body {
            margin: 0;
            color: var(--text);
            font-family: Inter, ui-sans-serif, system-ui, Segoe UI, Roboto, Helvetica, Arial;
            -webkit-font-smoothing: antialiased;
            line-height: 1.45;

            /* Background with overlay to reduce image visibility */
            background:
                /* 0.6 = darker overlay */
                url('https://images.unsplash.com/photo-1507525428034-b723cf961d3e') no-repeat center/cover;
        }


        .container {
            width: min(1100px, 92%);
            margin-inline: auto
        }

        /* Enhanced Header Styles */
        .header {
            position: sticky;
            top: 0;
            z-index: 50;
            /* background: linear-gradient(rgba(0, 0, 0, 0), rgba(255, 255, 255, 0)); */
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(238, 240, 245, .6);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        }

        .nav {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: .8rem 0;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: .7rem;
            text-decoration: none
        }

        .logo {
            width: 38px;
            height: 38px;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--brand), #60a5fa);
            display: grid;
            place-items: center;
            color: #fff;
            font-weight: 800
        }

        .brand-title {
            font-weight: 800;
            letter-spacing: .5px;
            font-size: 1.4rem;
            background: linear-gradient(135deg, var(--brand), #60a5fa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            color: var(--brand);
            text-shadow: 0 2px 6px rgba(37, 99, 235, 0.2);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .nav-links {
            display: flex;
            gap: 1rem;
        }

        .nav-links a {
            position: relative;
            color: var(--muted);
            text-decoration: none;
            font-weight: 600;
            padding: .6rem .8rem;
            border-radius: 10px;
            transition: all .3s ease;
        }

        .nav-links a::after {
            content: "";
            position: absolute;
            left: 50%;
            bottom: 4px;
            width: 0;
            height: 2px;
            background: var(--brand);
            border-radius: 4px;
            transition: all .3s ease;
            transform: translateX(-50%);
        }

        .nav-links a:hover {
            color: var(--brand);
            background: rgba(37, 99, 235, 0.05);
            transform: translateY(-1px);
        }

        .nav-links a:hover::after {
            width: 60%;
        }

        .nav-links a.active {
            color: var(--brand);
        }

        .nav-links a.active::after {
            width: 60%;
        }

        .menu-container {
            position: relative;
            display: inline-block;
        }

        .menu-btn {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(37, 99, 235, 0.2);
            color: var(--brand);
            padding: 0.8rem 1.2rem;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.1);
        }

        .menu-btn:hover {
            background: rgba(37, 99, 235, 0.05);
            border-color: var(--brand);
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(37, 99, 235, 0.15);
        }

        .menu-dropdown {
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            width: 280px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1), 0 8px 16px rgba(0, 0, 0, 0.06), inset 0 1px 0 rgba(255, 255, 255, 0.6);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px) scale(0.95);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
        }

        .menu-dropdown.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0) scale(1);
        }

        .menu-header {
            padding: 1.2rem 1.5rem 0.8rem;
            border-bottom: 1px solid rgba(37, 99, 235, 0.1);
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.05), rgba(96, 165, 250, 0.05));
        }

        .menu-title {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--brand);
            margin: 0;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .menu-subtitle {
            font-size: 0.8rem;
            color: var(--muted);
            margin: 0.2rem 0 0;
        }

        .menu-items {
            padding: 0.8rem 0;
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            padding: 0.8rem 1.5rem;
            color: var(--text);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s ease;
            border: none;
            background: none;
            width: 100%;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.9rem;
        }

        .menu-item:hover {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.08), rgba(96, 165, 250, 0.08));
            color: var(--brand);
            transform: translateX(4px);
        }

        .menu-item.danger:hover {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.08), rgba(248, 113, 113, 0.08));
            color: #ef4444;
        }

        .menu-icon {
            width: 18px;
            height: 18px;
            opacity: 0.7;
            transition: opacity 0.2s ease;
        }

        .menu-item:hover .menu-icon {
            opacity: 1;
        }

        .menu-divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(37, 99, 235, 0.1), transparent);
            margin: 0.5rem 1rem;
        }

        .wrap {
            max-width: 1200px;
            margin: auto;
            padding: 20px;
            background: linear-gradient(rgba(105, 105, 105, 0.6), rgba(255, 253, 253, 0.9))
        }


        .topbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(255, 255, 255, .02);
            backdrop-filter: blur(8px);
            border: 1px solid var(--stroke);
            border-radius: 18px;
            padding: 14px 16px 14px 14px;
            box-shadow: var(--shadow)
        }

        .topbar .brand {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
            font-size: 18px;
            letter-spacing: .2px
        }

        .topbar .brand .dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: linear-gradient(135deg, #22d3ee, #4f46e5)
        }

        .pill {
            display: flex;
            gap: 10px;
            align-items: center;
            font-size: 14px;
            color: var(--muted)
        }

        .pill span {
            background: #ffffff;
            border: 1px solid var(--stroke);
            padding: 8px 10px;
            border-radius: 999px
        }

        .modify {
            border: 1px solid var(--stroke);
            background: #ffffff;
            padding: 8px 12px;
            border-radius: 10px;
            color: #000000;
            cursor: pointer
        }

        .grid {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 16px;
            margin-top: 16px
        }

        @media (max-width:980px) {
            .grid {
                grid-template-columns: 1fr
            }
        }

        .panel {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--stroke);
            border-radius: var(--radius);
            box-shadow: var(--shadow)
        }

        /* sidebar filters */
        .filters {
            padding: 16px;
            position: sticky;
            top: 16px
        }

        .section {
            margin-bottom: 18px
        }

        .section h4 {
            margin: 0 0 10px;
            font-size: 13px;
            color: #212328;
            text-transform: uppercase;
            letter-spacing: .12em
        }

        .slider-row {
            display: flex;
            align-items: center;
            gap: 10px
        }

        .price-value {
            width: 100%;
            display: flex;
            gap: 8px
        }

        .price-value input {
            flex: 1;
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.08), rgba(96, 165, 250, 0.08));
            border: 1px solid var(--stroke);
            color: var(--text);
            padding: 10px;
            border-radius: 10px
        }

        input[type="range"] {
            width: 100%
        }

        .check {
            display: flex;
            gap: 10px;
            align-items: center;
            margin: 8px 0;
            color: #2a2b2f
        }

        .chip {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            border: 1px solid var(--stroke);
            padding: 8px 10px;
            border-radius: 999px;
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.08), rgba(96, 165, 250, 0.08));
            color: #040404;
            font-size: 14px;
            cursor: pointer;
            margin-right: 3px;
            margin-bottom: 3px;
        }

        .chip input {
            accent-color: var(--accent)
        }

        .reset {
            margin-top: 6px;
            background: transparent;
            border: 1px dashed var(--stroke);
            color: #306eff;
            padding: 8px 10px;
            border-radius: 10px;
            cursor: pointer
        }

        /* results list */
        .results {
            padding: 12px
        }

        .banner {
            display: flex;
            align-items: center;
            gap: 10px;
            border-radius: 12px;
            border: 1px solid var(--stroke);
            background: linear-gradient(180deg, rgba(79, 70, 229, 0.12), rgba(0, 0, 0, 0));
            padding: 10px 12px;
            margin: 8px 0 14px
        }

        .results-count {
            color: #004cff;
            font-size: 14px
        }

        .list {
            display: flex;
            flex-direction: column;
            gap: 12px
        }

        .card {
            border: 1px solid var(--stroke);
            border-radius: 16px;
            background: linear-gradient(180deg, rgba(255, 255, 255, .03), rgba(255, 255, 255, .01));
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 8px;
            padding: 14px;
            transition: transform .15s ease, box-shadow .15s ease
        }

        .card:hover {
            transform: translateY(-1px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, .35)
        }

        .row {
            display: flex;
            align-items: center;
            gap: 14px
        }

        .main {
            display: grid;
            grid-template-columns: 1.1fr .7fr .8fr .8fr;
            gap: 12px;
            align-items: center
        }

        @media (max-width:760px) {
            .main {
                grid-template-columns: 1fr;
                gap: 6px
            }
        }

        .meta .big {
            font-size: 16px;
            font-weight: 600
        }

        .meta .sub {
            font-size: 12px;
            color: #17274d
        }

        .dots {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #9aa3b8;
            font-size: 12px
        }

        .dots:before,
        .dots:after {
            content: "";
            height: 1px;
            background: #29324a;
            flex: 1
        }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: #0050f1;
            background: rgba(0, 76, 255, 0.12);
            border: 1px solid rgba(34, 118, 197, 0.3);
            padding: 6px 8px;
            border-radius: 999px
        }

        .rhs {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 8px;
            padding-left: 10px;
            border-left: 1px solid var(--stroke)
        }

        .price {
            font-size: 20px;
            font-weight: 800;
            letter-spacing: .2px
        }

        .pre {
            font-size: 12px;
            color: #9aa3b8;
            text-decoration: line-through
        }

        .btn {
            background: linear-gradient(135deg, #2d72c7, #2590d2);
            color: #ffffff;
            border: 0;
            border-radius: 10px;
            padding: 10px 14px;
            font-weight: 700;
            cursor: pointer
        }

        .btn:hover {
            filter: brightness(.98)
        }

        .subtle {
            font-size: 12px;
            color: #8d1818
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin-top: 20px;
            padding: 10px 0;
        }

        .pagination button {
            background: linear-gradient(135deg, #2d72c7, #2590d2);
            color: #ffffff;
            border: 0;
            border-radius: 10px;
            padding: 8px 12px;
            font-weight: 600;
            cursor: pointer;
            transition: filter .15s ease;
        }

        .pagination button:disabled {
            background: #9aa3b8;
            cursor: not-allowed;
        }

        .pagination button:hover:not(:disabled) {
            filter: brightness(.98);
        }

        .pagination span {
            font-size: 14px;
            color: #9aa3b8;
        }



        .footer {
            background: linear-gradient(135deg, rgba(30, 58, 138, 0.95), rgba(59, 130, 246, 0.95));
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            padding: 3rem 0 2rem;
            margin-top: auto;
            position: relative;
            overflow: hidden;
        }

        .footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 20% 50%, rgba(255, 255, 255, 0.1) 0%, transparent 50%), radial-gradient(circle at 80% 20%, rgba(255, 255, 255, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            position: relative;
            z-index: 1;
        }

        .footer-top {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
            margin-bottom: 2rem;
            align-items: center;
        }

        .footer-brand {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .footer-logo {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 20px;
            backdrop-filter: blur(10px);
        }

        .footer-brand-text {
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
            letter-spacing: -0.5px;
        }

        .footer-description {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.95rem;
            line-height: 1.6;
            margin-bottom: 1.5rem;
        }

        .footer-links {
            display: flex;
            gap: 2rem;
            justify-content: flex-end;
            flex-wrap: wrap;
        }

        .footer-links a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            position: relative;
        }

        .footer-links a:hover {
            color: white;
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .footer-bottom {
            padding-top: 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            text-align: center;
        }

        .footer-bottom p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            margin: 0;
        }

        .footer-heart {
            color: #ef4444;
            animation: heartbeat 2s ease-in-out infinite;
        }

        @keyframes heartbeat {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
            }
        }

        @media(max-width:768px) {
            .destinations {
                flex-direction: column;
                align-items: center;
            }

            .footer-top {
                grid-template-columns: 1fr;
                text-align: center;
            }

            .footer-links {
                justify-content: center;
                flex-wrap: wrap;
            }
        }

        .back-btn {
      align-self:flex-start;
      margin-bottom:1rem;
      padding:0.5rem 1rem;
      border:none;
      border-radius:6px;
      background:rgba(255,255,255,0.2);
      color:white;
      font-size:0.95rem;
      cursor:pointer;
    }
    .back-btn:hover { background:rgba(255,255,255,0.35); }

    </style>
</head>

<body>
    <header class="header">
        <div class="container nav">
            <a class="brand" href="#">
                <div class="logo">✈</div>
                <div class="brand-title">Wanderlust</div>
            </a>
            <nav class="nav-links" aria-label="Primary">
                <a href="index.html">Home</a>
                <a href="searchPage.html">Booking</a>
                <a href="destination.html" >Destinations</a>
                <a href="CustomerContact.html">Contact</a>
            </nav>

            <div class="menu-container">
                <button class="menu-btn" onclick="toggleMenu()">
                    <span>Account</span>
                    <span style="margin-left: 4px; transition: transform 0.3s ease;" id="menu-arrow">▼</span>
                </button>
                <div class="menu-dropdown" id="menuDropdown">
                    <div class="menu-header">
                        <h3 class="menu-title">Account</h3>
                        <p class="menu-subtitle">Manage your travel preferences</p>
                    </div>
                    <div class="menu-items">
                        <button id="loginButton" class="menu-item" onclick="window.location.href='login.html'">
                            <span class="menu-icon">🔑</span>Login
                        </button>
                        <button id="signupButton" class="menu-item" onclick="window.location.href='signup.html'">
                            <span class="menu-icon">📝</span>Sign Up
                        </button>

                        <div class="menu-divider"></div>

                        <button id="profile" class="menu-item" onclick="window.location.href='profileManage.html'">
                            <span class="menu-icon">👤</span>My Profile
                        </button>

                        <div class="menu-divider"></div>

                        <button id="logoutbutton" class="menu-item danger">
                            <span class="menu-icon">🚪</span>Logout
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="wrap">
        <div class="topbar">
           
            <button class="back-btn" onclick="window.location.href='';">← Back</button>
        </div>

        <div class="grid">
            <!-- Filters -->
            <aside class="panel filters">
                <div class="section">
                    <h4>Price (LKR)</h4>
                    <div class="slider-row">
                        <input type="range" id="priceMin" min="50" max="10000" value="5" step="5"
                            oninput="syncPrice()" />
                    </div>
                    <div class="price-value">
                        <input id="minBox" type="number" min="50" max="10000" step="5" value="50"
                            oninput="syncSlider()" />
                        <input id="maxBox" type="number" min="50" max="10000" step="5" value="10000"
                            oninput="syncSlider()" />
                    </div>
                </div>

                <div class="section">
                    <h4>Fare Type</h4>
                    <label class="check"><input id="refundable" type="checkbox" /> Refundable only</label>
                </div>

                <div class="section">
                    <h4>Stops</h4>
                    <label class="chip"><input type="radio" name="stops" value="any" checked> Any</label>
                    <label class="chip"><input type="radio" name="stops" value="nonstop"> Non-stop</label>
                    <label class="chip"><input type="radio" name="stops" value="1"> 1 Stop</label>
                    <label class="chip"><input type="radio" name="stops" value="2"> 2+ Stops</label>
                </div>

                <button class="reset" onclick="resetFilters()">Reset filters</button>
            </aside>

            <!-- Results -->
            <section class="panel results">
                <div class="banner">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                        <path d="M12 2l3 7h7l-5.5 4 2 7L12 17l-6.5 3 2-7L2 9h7l3-7z" stroke="#a5b4fc" />
                    </svg>
                    <div class="results-count" id="count"></div>
                </div>
                <div class="list" id="list"></div>
                <div class="pagination" id="pagination"></div>
            </section>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-top">
                <div>
                    <div class="footer-brand">
                        <div class="footer-logo">W</div>
                        <div class="footer-brand-text">WanderLite</div>
                    </div>
                    <p class="footer-description">Your gateway to extraordinary adventures. Discover breathtaking
                        destinations,
                        connect with fellow travelers, and create memories that last a lifetime.</p>
                </div>
                <div class="footer-links">
                    <a href="#">Privacy Policy</a>
                    <a href="#">Terms of Service</a>
                    <a href="#">Support</a>
                    <a href="#">Contact Us</a>
                </div>
            </div>
            <div class="footer-bottom">
                <p>© 2024 WanderLite Travel. Made with <span class="footer-heart">♥</span> for adventurers worldwide.
                </p>
            </div>
        </div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script>
        const listEl = document.getElementById('list');
        const countEl = document.getElementById('count');
        const paginationEl = document.getElementById('pagination');

        const itemsPerPage = 4;
        let currentPage = 1;
        let flights = [];
        let filteredFlights = [];
        let allFlights = [];


        $(document).ready(() => {
           
            var token = localStorage.getItem('token');

            if (token) {
                // User is logged in → show profile & logout, hide login & signup
                $("#profile").show();
                $("#logoutbutton").show();
                $("#loginButton").hide();
                $("#signupButton").hide();
            } else {
                // User is not logged in → hide profile & logout, show login & signup
                $("#profile").hide();
                $("#logoutbutton").hide();
                $("#loginButton").show();
                $("#signupButton").show();
            }

            // Optional: handle logout
            $("#logoutbutton").click(function () {
                localStorage.removeItem('token');
                location.reload(); // refresh page to update menu
            });
        });

        // --- Helpers ---
        function format(n) {
            return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }

        function getStopsText(stops) {
            if (stops === 0) return "Non-stop";
            if (stops === 1) return "1 Stop";
            return `${stops}+ Stops`;
        }

        function getStopsDescription(stops) {
            if (stops === 0) return "Direct flight";
            if (stops === 1) return "One connection";
            return `${stops} connections`;
        }

        function formatDate(date) {
            if (!date) return '';
            const d = new Date(date);
            return d.toLocaleDateString() + ' ' + d.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }

        // --- Render flights ---
        function render(items, page = 1) {
            listEl.innerHTML = '';
            const start = (page - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const paginatedItems = items.slice(start, end);

            if (paginatedItems.length === 0) {
                listEl.innerHTML = '<div style="text-align:center;padding:2rem;color:var(--muted)">No flights found</div>';
                countEl.textContent = '0 Flights Found';
                paginationEl.innerHTML = '';
                return;
            }

            paginatedItems.forEach((f, index) => {
                const card = document.createElement('article');
                card.className = 'card';
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';

                const airlineCode = f.airline ? f.airline.substring(0, 2).toUpperCase() : 'FL';

                card.innerHTML = `
            <div class="main">
                <div class="row">
                    <div class="logo" style="background: linear-gradient(135deg, var(--brand), #60a5fa); color: white; padding: 8px; border-radius: 8px; font-weight: bold; min-width: 40px; text-align: center;">
                        ${airlineCode}
                    </div>
                    <div class="meta">
                        <div class="big">${f.airline || 'Unknown Airline'} • ${f.code || 'N/A'}</div>
                        <div class="sub">${f.travelClass || 'Economy'} • ${getStopsText(f.stops)}</div>
                        <div class="sub">${getStopsDescription(f.stops)}</div>
                    </div>
                </div>
                <div class="meta">
                    <div class="big">${f.departureAirport} → ${f.arrivalAirport} </div>
                </div>
                <div class="meta">
                    <div class="sub">${formatDate(f.departureDate)} ${f.arrivalDate ? '→ ' + formatDate(f.arrivalDate) : ''}</div>
                </div>
                <div class="meta">
                    <div class="big">${f.flightDuration}</div>
                </div>
            </div>
            <div class="rhs">
                <div class="price">USD ${format(f.price || 0)}</div>
                ${f.refundable ? '<span class="badge">✓ Refundable</span>' : '<span class="subtle">Non-refundable</span>'}
                <button class="btn" onclick="bookFlight(${f.id})">Book Now</button>
            </div>
        `;

                listEl.appendChild(card);

                setTimeout(() => {
                    card.style.transition = 'all 0.3s ease';
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }, index * 100);
            });

            countEl.textContent = `${items.length} Flight${items.length !== 1 ? 's' : ''} Found`;
            renderPagination(items.length);
        }

        // --- Pagination ---
        function renderPagination(totalItems) {
            paginationEl.innerHTML = '';
            const totalPages = Math.ceil(totalItems / itemsPerPage);

            const prevButton = document.createElement('button');
            prevButton.textContent = 'Previous';
            prevButton.disabled = currentPage === 1;
            prevButton.onclick = () => {
                if (currentPage > 1) {
                    currentPage--;
                    render(filteredFlights, currentPage);
                }
            };
            paginationEl.appendChild(prevButton);

            const pageInfo = document.createElement('span');
            pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
            paginationEl.appendChild(pageInfo);

            const nextButton = document.createElement('button');
            nextButton.textContent = 'Next';
            nextButton.disabled = currentPage === totalPages || totalPages === 0;
            nextButton.onclick = () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    render(filteredFlights, currentPage);
                }
            };
            paginationEl.appendChild(nextButton);
        }

        // --- Flight search ---
        function searchTickets(params) {
            const url = `http://localhost:8080/api/v1/ticketData/searchTicket?departureAirport=${encodeURIComponent(params.from)}&arrivalAirport=${encodeURIComponent(params.to)}&departureDate=${encodeURIComponent(params.depart)}&arrivalDate=${encodeURIComponent(params.returnDate || '')}&travel_class=${encodeURIComponent(params.travelClass)}`;

            $.ajax({
                url: url,
                type: 'GET',
                success: function (res) {
                    if (res && res.data && res.data.length > 0) {
                        allFlights = res.data;
                        flights = res.data.map(t => ({
                            id: t.id,
                            airline: t.airlineName || 'Unknown Airline',
                            code: t.flightNumber || '---',
                            departureAirport: t.departureAirport,
                            arrivalAirport: t.arrivalAirport,
                            departureDate: t.departureDate,
                            arrivalDate: t.arrivalDate,
                            travelClass: t.travelClass,
                            stops: t.stops || 0,
                            refundable: t.refundable || false,
                            price: t.totalPrice || 0,
                            flightDuration: t.flightDuration || 'N/A'
                        }));
                        filteredFlights = [...flights];
                        render(filteredFlights, currentPage);
                    } else {
                        listEl.innerHTML = '<div style="text-align:center;padding:2rem;color:var(--muted)">No flights found</div>';
                    }
                },
                error: function (err) {
                    console.error('Search failed', err);
                    listEl.innerHTML = '<div style="text-align:center;padding:2rem;color:var(--muted)">Search request failed</div>';
                }
            });
        }

        // --- Booking ---
        function bookFlight(flightId) {
            const selectedFlight = allFlights.find(f => f.id === Number(flightId));
            if (selectedFlight) {
                localStorage.setItem('selectedFlight', JSON.stringify(selectedFlight));
            } else {
                alert('Flight not found');
            }
            // localStorage.setItem('selectedFlightId', flightId);
            window.location.href = 'flightTravelerDetail.html';
        }

        // --- Menu toggle ---
        function toggleMenu() {
            const menu = document.getElementById('menuDropdown');
            const arrow = document.getElementById('menu-arrow');
            if (menu.style.display === 'block') {
                menu.style.display = 'none';
                arrow.style.transform = 'rotate(0deg)';
            } else {
                menu.style.display = 'block';
                arrow.style.transform = 'rotate(180deg)';
            }
        }

        // --- Filters ---
        function applyFilters() {
            const minPrice = parseInt(document.getElementById('minBox').value) || 0;
            const maxPrice = parseInt(document.getElementById('maxBox').value) || Infinity;
            const refundableOnly = document.getElementById('refundable').checked;
            const stopsValue = document.querySelector('input[name="stops"]:checked').value;

            filteredFlights = flights.filter(f => {
                if (f.price < minPrice || f.price > maxPrice) return false;
                if (refundableOnly && !f.refundable) return false;
                if (stopsValue === 'nonstop' && f.stops !== 0) return false;
                if (stopsValue === '1' && f.stops !== 1) return false;
                if (stopsValue === '2' && f.stops < 2) return false;
                return true;
            });

            currentPage = 1;
            render(filteredFlights, currentPage);
        }

        // --- Sync price sliders & boxes ---
        function syncPrice() {
            const minBox = document.getElementById('minBox');
            const slider = document.getElementById('priceMin');
            minBox.value = slider.value;
            applyFilters();
        }

        function syncSlider() {
            const minBox = document.getElementById('minBox');
            const slider = document.getElementById('priceMin');
            slider.value = minBox.value;
            applyFilters();
        }

        // --- Reset filters ---
        function resetFilters() {
            document.getElementById('priceMin').value = 50;
            document.getElementById('minBox').value = 50;
            document.getElementById('maxBox').value = 10000;
            document.getElementById('refundable').checked = false;
            document.querySelector('input[name="stops"][value="any"]').checked = true;
            applyFilters();
        }

        // --- Add event listeners ---
        document.getElementById('minBox').addEventListener('input', applyFilters);
        document.getElementById('maxBox').addEventListener('input', applyFilters);
        document.getElementById('priceMin').addEventListener('input', applyFilters);
        document.getElementById('refundable').addEventListener('change', applyFilters);
        document.querySelectorAll('input[name="stops"]').forEach(r => r.addEventListener('change', applyFilters));

        // --- Document ready ---
        $(document).ready(function () {
            const params = JSON.parse(localStorage.getItem('searchParams'));
            if (!params) return alert('No search parameters found!');
            searchTickets(params);
        });

        function toggleMenu() {
            const dropdown = document.getElementById('menuDropdown');
            const arrow = document.getElementById('menu-arrow');

            dropdown.classList.toggle('show');

            if (dropdown.classList.contains('show')) {
                arrow.style.transform = 'rotate(180deg)';
            } else {
                arrow.style.transform = 'rotate(0deg)';
            }
        }


    </script>

</body>

</html>